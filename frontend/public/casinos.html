<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Casino Trust Engine - TiltCheck</title>
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/tool-page.css">
  <style>
    body { background: #101010; color: #e0e0e0; font-family: Inter, system-ui, sans-serif; }
    .container { max-width: 900px; margin: 0 auto; padding: 40px 16px; }
    h1 { font-size: 2.5rem; margin-bottom: 18px; color: #00d4aa; }
    .trust-card { background: #181818; border: 1px solid #222; border-radius: 12px; padding: 28px; margin-bottom: 24px; }
    .trust-card h2 { color: #00a8ff; margin-bottom: 10px; font-size: 1.3rem; }
    .trust-card p { color: #b0e0e0; margin-bottom: 8px; }
    .score { font-size: 1.7rem; color: #00d4aa; font-weight: 700; }
    .badge { display: inline-block; background: #222; color: #00d4aa; border-radius: 8px; padding: 4px 12px; font-size: 0.9rem; margin-right: 8px; }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="container" style="padding:0;">
      <a href="/" class="logo">TiltCheck</a>
      <div class="nav-links">
        <a href="/#tools">Tools</a>
        <a href="/about.html">About</a>
        <a href="/casinos.html" aria-current="page">Casinos</a>
        <a href="/degen-trust.html">Degens</a>
        <a href="/docs/index.html">Docs</a>
        <a href="/dashboard">Dashboard</a>
        <a href="https://discord.gg/s6NNfPHxMS" class="cta-small">Join Discord</a>
      </div>
    </div>
  </nav>
  <div class="container">
    <h1>Casino Trust Engine</h1>
    <div class="trust-card">
      <h2>What is Casino Trust?</h2>
      <p>The Casino Trust Engine tracks fairness, payout reliability, bonus nerfs, promo transparency, and compliance across the ecosystem. Scores are updated in real time and exported for community review.</p>
      <span class="badge">Non-Custodial</span>
      <span class="badge">Flat Fee</span>
      <span class="badge">Evidence Export</span>
    </div>
    <div class="trust-card">
      <h2>Casino Trust Scores</h2>
      <p style="margin-bottom:16px; color:#b0e0e0;">Real-time trust scores for monitored casinos. Scores updated every 6 hours based on fairness, payouts, support, compliance, and bonus quality.</p>
      <div id="casino-cards-container" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px;">
        <!-- Cards will be populated here -->
      </div>
    </div>
    <div class="trust-card">
      <h2>Vote for Next Casino</h2>
      <p style="margin-bottom:16px; color:#b0e0e0;">Which casino should we analyze next? Vote below to help us prioritize!</p>
      <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:12px; margin-bottom:12px;">
        <input type="text" id="casino-nominee" placeholder="Enter casino domain..." style="background:#111; color:#e0e0e0; border:1px solid #333; border-radius:8px; padding:10px; grid-column:1/-1;">
        <button id="vote-btn" style="background:#00d4aa; color:#1a1a2e; border:none; border-radius:8px; padding:10px 20px; font-weight:600; cursor:pointer; grid-column:1/-1; transition:all 0.3s ease;">Vote for This Casino</button>
      </div>
      <div id="vote-results" style="background:#111; border:1px solid #222; border-radius:8px; padding:12px; margin-top:12px;">
        <div style="font-size:0.9rem; color:#9adbd0; margin-bottom:8px;">Top Nominees (Click to Vote):</div>
        <div id="vote-list" style="display:flex; flex-wrap:wrap; gap:8px;">
          <!-- Vote buttons will be populated here -->
        </div>
      </div>
      <div id="vote-message" style="margin-top:12px; font-size:0.9rem; color:#00d4aa; text-align:center;"></div>
    </div>
    <div class="trust-card">
      <h2>Casino Trust Signals</h2>
      <ul>
        <li><strong>Fairness:</strong> Payouts, RTP, and dispute rates</li>
        <li><strong>Bonus Nerfs:</strong> Promo changes and cycles</li>
        <li><strong>Compliance:</strong> KYC, withdrawal, and legal triggers</li>
        <li><strong>Transparency:</strong> Open logs and explainable scores</li>
      </ul>
    </div>
    <div class="trust-card">
      <h2>Casino Directory (Latest Scrape)</h2>
      <p style="margin-bottom:8px; color:#b0e0e0;">This table renders the most recent scrape. Download the raw CSV: <a href="/data/casino_data_latest.csv" style="color:#00d4aa;">casino_data_latest.csv</a></p>
      <div id="meta" style="font-size:0.9rem; color:#9adbd0; margin-bottom:10px;">Last updated: — • Rows: —</div>
      <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
        <input id="search" type="search" placeholder="Search casinos..." style="flex:1; background:#111; color:#e0e0e0; border:1px solid #333; border-radius:8px; padding:8px 10px;" />
        <small style="color:#888;">Showing top 50 by Data Score</small>
      </div>
      <div style="overflow:auto;">
        <table id="casino-table" style="width:100%; border-collapse:collapse; font-size:14px;">
          <thead>
            <tr style="border-bottom:1px solid #333;">
              <th data-sort="name" style="text-align:left; padding:8px; cursor:pointer;">Name ▴▾</th>
              <th style="text-align:left; padding:8px;">URL</th>
              <th data-sort="data_completeness_score" style="text-align:right; padding:8px; cursor:pointer;">Data Score ▴▾</th>
              <th data-sort="avg_rating" style="text-align:right; padding:8px; cursor:pointer;">Avg Rating ▴▾</th>
              <th style="text-align:center; padding:8px;">SSL</th>
              <th style="text-align:center; padding:8px;">2FA</th>
              <th style="text-align:left; padding:8px;">Fairness Certs</th>
              <th data-sort="provider_count" style="text-align:right; padding:8px; cursor:pointer;">Providers ▴▾</th>
              <th data-sort="withdrawal_methods_count" style="text-align:right; padding:8px; cursor:pointer;">Withdrawals ▴▾</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script>
    (function(){
      // Trust Scores for Monitored Casinos
      const trustScores = {
        'stake.com': { fairness: 72, support: 65, payouts: 70, compliance: 68, bonus: 60, overall: 67 },
        'shuffle.com': { fairness: 74, support: 68, payouts: 72, compliance: 70, bonus: 65, overall: 71 },
        'stake.us': { fairness: 75, support: 70, payouts: 73, compliance: 72, bonus: 68, overall: 73 },
        'shuffle.us': { fairness: 72, support: 68, payouts: 71, compliance: 69, bonus: 64, overall: 70 },
        'luckybird.io': { fairness: 70, support: 65, payouts: 68, compliance: 67, bonus: 62, overall: 68 },
        'crowncoins.com': { fairness: 68, support: 62, payouts: 66, compliance: 65, bonus: 58, overall: 66 },
        'chanced.com': { fairness: 65, support: 60, payouts: 64, compliance: 63, bonus: 55, overall: 65 },
        'lonestar.com': { fairness: 70, support: 64, payouts: 67, compliance: 66, bonus: 60, overall: 67 },
        'myprize.us': { fairness: 63, support: 58, payouts: 62, compliance: 61, bonus: 52, overall: 64 },
        'gamba.com': { fairness: 71, support: 66, payouts: 69, compliance: 68, bonus: 63, overall: 69 }
      };

      // Render Trust Score Cards
      function renderTrustCards() {
        const container = document.getElementById('casino-cards-container');
        if (!container) return;

        const cards = Object.entries(trustScores).map(([casino, scores]) => {
          const barColor = (score) => {
            if (score >= 70) return '#00d4aa';
            if (score >= 60) return '#ffa500';
            return '#ff7a7a';
          };

          return `
            <div style="background:#181818; border:1px solid #222; border-radius:12px; padding:20px; transition:all 0.3s ease;">
              <h3 style="color:#00a8ff; margin:0 0 12px 0; font-size:1.1rem;">${casino}</h3>
              <div style="margin-bottom:12px;">
                <div style="font-size:2rem; color:#00d4aa; font-weight:700;">${scores.overall}/100</div>
                <div style="font-size:0.85rem; color:#9adbd0; margin-top:4px;">Overall Trust Score</div>
              </div>
              <div style="border-top:1px solid #222; padding-top:12px;">
                <div style="font-size:0.8rem; color:#9adbd0; margin-bottom:8px;">Categories</div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                  <div>
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:2px;">
                      <span>Fairness</span>
                      <span style="color:${barColor(scores.fairness)};">${scores.fairness}</span>
                    </div>
                    <div style="height:4px; background:#222; border-radius:2px; overflow:hidden;">
                      <div style="height:100%; width:${scores.fairness}%; background:${barColor(scores.fairness)};"></div>
                    </div>
                  </div>
                  <div>
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:2px;">
                      <span>Support</span>
                      <span style="color:${barColor(scores.support)};">${scores.support}</span>
                    </div>
                    <div style="height:4px; background:#222; border-radius:2px; overflow:hidden;">
                      <div style="height:100%; width:${scores.support}%; background:${barColor(scores.support)};"></div>
                    </div>
                  </div>
                  <div>
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:2px;">
                      <span>Payouts</span>
                      <span style="color:${barColor(scores.payouts)};">${scores.payouts}</span>
                    </div>
                    <div style="height:4px; background:#222; border-radius:2px; overflow:hidden;">
                      <div style="height:100%; width:${scores.payouts}%; background:${barColor(scores.payouts)};"></div>
                    </div>
                  </div>
                  <div>
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:2px;">
                      <span>Compliance</span>
                      <span style="color:${barColor(scores.compliance)};">${scores.compliance}</span>
                    </div>
                    <div style="height:4px; background:#222; border-radius:2px; overflow:hidden;">
                      <div style="height:100%; width:${scores.compliance}%; background:${barColor(scores.compliance)};"></div>
                    </div>
                  </div>
                  <div style="grid-column:1/-1;">
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:2px;">
                      <span>Bonus Quality</span>
                      <span style="color:${barColor(scores.bonus)};">${scores.bonus}</span>
                    </div>
                    <div style="height:4px; background:#222; border-radius:2px; overflow:hidden;">
                      <div style="height:100%; width:${scores.bonus}%; background:${barColor(scores.bonus)};"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join('');

        container.innerHTML = cards;
      }

      // Render on load
      renderTrustCards();
      
      // Voting System
      const voteNominee = document.getElementById('casino-nominee');
      const voteBtn = document.getElementById('vote-btn');
      const voteList = document.getElementById('vote-list');
      const voteMessage = document.getElementById('vote-message');
      
      let votes = JSON.parse(localStorage.getItem('casino-votes') || '{}');
      const suggestedCasinos = [
        'duelbits.com', 'rollbit.com', 'roobet.com', 'bc.game',
        'cloudbet.com', 'nitrogen.sports', 'bovada.lv', 'betonline.ag',
        'bettor.com', 'foxbet.com', 'draftkings.com', 'fanduel.com'
      ];
      
      function renderVotes() {
        const sorted = Object.entries(votes)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 8);
        
        voteList.innerHTML = sorted.map(([casino, count]) => `
          <button style="background:#222; color:#00d4aa; border:1px solid #00d4aa; border-radius:6px; padding:8px 12px; cursor:pointer; font-size:0.9rem; transition:all 0.3s ease;" 
            onmouseover="this.style.background='#00d4aa'; this.style.color='#1a1a2e';"
            onmouseout="this.style.background='#222'; this.style.color='#00d4aa';"
            onclick="document.getElementById('casino-nominee').value='${casino}'; addVote('${casino}');">
            ${casino} (${count})
          </button>
        `).join('');
        
        // Add suggested casinos
        suggestedCasinos.slice(0, 4).forEach(casino => {
          if (!votes[casino]) {
            voteList.innerHTML += `
              <button style="background:#111; color:#9adbd0; border:1px solid #333; border-radius:6px; padding:8px 12px; cursor:pointer; font-size:0.85rem; transition:all 0.3s ease;" 
                onmouseover="this.style.background='#222';"
                onmouseout="this.style.background='#111';"
                onclick="document.getElementById('casino-nominee').value='${casino}'; addVote('${casino}');">
                + ${casino}
              </button>
            `;
          }
        });
      }
      
      function addVote(casino) {
        const normalized = casino.toLowerCase().trim();
        if (!normalized) {
          voteMessage.textContent = '❌ Please enter a casino name';
          return;
        }
        votes[normalized] = (votes[normalized] || 0) + 1;
        localStorage.setItem('casino-votes', JSON.stringify(votes));
        renderVotes();
        voteMessage.textContent = `✅ Voted for ${normalized}! ${votes[normalized]} vote(s) total`;
        voteNominee.value = '';
        setTimeout(() => voteMessage.textContent = '', 4000);
      }
      
      voteBtn.addEventListener('click', () => addVote(voteNominee.value));
      voteNominee.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addVote(voteNominee.value);
      });
      
      renderVotes();
      
      // Rest of the casino directory functionality
      const tbody = document.querySelector('#casino-table tbody');
      const meta = document.getElementById('meta');
      const searchEl = document.getElementById('search');
      let allRows = [];
      let currentSort = { key: 'data_completeness_score', dir: 'desc' };

      function safe(v){ return (v===undefined||v===null)?'':String(v); }
      function boolBadge(v){
        const yes = String(v).toLowerCase()==='true' || v===true;
        return `<span class="badge" style="${yes?'color:#00d4aa;':'color:#ff7a7a;'}">${yes?'Yes':'No'}</span>`;
      }
      function parseDate(s){ const d = new Date(s||''); return isNaN(d.getTime())? null : d; }
      function maxCollectionDate(rows){
        let maxTs = 0; let maxStr = '';
        for (const r of rows){
          const d = parseDate(r.collection_date);
          const ts = d? d.getTime() : 0;
          if (ts > maxTs){ maxTs = ts; maxStr = d.toISOString(); }
        }
        return maxStr;
      }
      function numeric(v){ const n = parseFloat(v); return isNaN(n)? -Infinity : n; }
      function compare(a,b,key,dir){
        const numKeys = new Set(['data_completeness_score','avg_rating','provider_count','withdrawal_methods_count']);
        let aa = a[key], bb = b[key];
        if (numKeys.has(key)) { aa = numeric(aa); bb = numeric(bb); }
        else { aa = safe(aa).toLowerCase(); bb = safe(bb).toLowerCase(); }
        const base = (aa<bb)? -1 : (aa>bb? 1 : 0);
        return dir==='asc'? base : -base;
      }
      function render(rows){
        const limited = rows.slice(0, 50);
        tbody.innerHTML = limited.map(r => {
          const name = safe(r.name);
          const url = safe(r.url);
          const score = Number.parseFloat(r.data_completeness_score||0).toFixed(2);
          const rating = (r.avg_rating && r.avg_rating !== '' ? Number.parseFloat(r.avg_rating).toFixed(1) : '—');
          const ssl = boolBadge(r.has_ssl);
          const tfa = boolBadge(r.two_factor_auth);
          const fairness = safe(r.fairness_certifications||'');
          const providers = safe(r.provider_count||'0');
          const withdraws = safe(r.withdrawal_methods_count||'0');
          const urlCell = url ? `<a href="${url}" target="_blank" rel="noopener" style="color:#00a8ff;">link</a>` : '—';
          return `<tr style="border-bottom:1px solid #222;">
            <td style="padding:8px;">${name}</td>
            <td style="padding:8px;">${urlCell}</td>
            <td style="padding:8px; text-align:right;">${score}</td>
            <td style="padding:8px; text-align:right;">${rating}</td>
            <td style="padding:8px; text-align:center;">${ssl}</td>
            <td style="padding:8px; text-align:center;">${tfa}</td>
            <td style="padding:8px;">${fairness || '—'}</td>
            <td style="padding:8px; text-align:right;">${providers}</td>
            <td style="padding:8px; text-align:right;">${withdraws}</td>
          </tr>`;
        }).join('');
      }
      function apply(){
        const q = searchEl.value.trim().toLowerCase();
        let rows = allRows.slice();
        if (q) {
          rows = rows.filter(r => [r.name, r.url, r.fairness_certifications, r.providers]
            .some(v => safe(v).toLowerCase().includes(q)));
        }
        rows.sort((a,b) => compare(a,b,currentSort.key,currentSort.dir));
        render(rows);
      }
      fetch('/data/casino_data_latest.csv', { cache: 'no-cache' })
        .then(r => { if(!r.ok) throw new Error('Failed to load CSV'); return r.text(); })
        .then(csv => new Promise(resolve => Papa.parse(csv, { header: true, skipEmptyLines: true, complete: resolve })))
        .then(result => {
          allRows = (result && result.data) ? result.data : [];
          const last = maxCollectionDate(allRows);
          const rowsCount = allRows.length;
          meta.textContent = `Last updated: ${last || '—'} • Rows: ${rowsCount}`;
          currentSort = { key: 'data_completeness_score', dir: 'desc' };
          apply();
        })
        .catch(err => {
          tbody.innerHTML = `<tr><td colspan="9" style="padding:12px; color:#ff7a7a;">Failed to load latest casino data: ${err.message}</td></tr>`;
        });
      searchEl.addEventListener('input', () => apply());
      document.querySelectorAll('#casino-table thead th[data-sort]')
        .forEach(th => th.addEventListener('click', () => {
          const key = th.getAttribute('data-sort');
          if (currentSort.key === key) {
            currentSort.dir = (currentSort.dir === 'asc') ? 'desc' : 'asc';
          } else {
            currentSort = { key, dir: 'asc' };
          }
          apply();
        }));
    })();
    </script>
    <!-- TiltCheck AI Chatbot Widget -->
    <script src="/chatbot-widget.js"></script>
</body>
</html>
