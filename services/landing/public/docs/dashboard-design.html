<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><title>Trust Metrics Dashboard Design (Draft) - TiltCheck</title><meta name="description" content="Purpose: Provide a scrappy, real-time window into multi-dimensional trust signals (domain, casino, degen/user) with emphasis on top movers, severity distribution, and snapshot thro"/><link rel="stylesheet" href="/styles/base.css"/><style>body{background:#0a0a0a;color:#e0e0e0;font-family:Inter,system-ui,sans-serif;margin:0;padding:0}main{max-width:900px;margin:0 auto;padding:40px 18px;line-height:1.7}a{color:#00d4aa;text-decoration:none}a:hover{text-decoration:underline}.page-hero{padding:54px 24px 32px;background:linear-gradient(135deg,#121212,#181818);border-bottom:1px solid #222}.page-hero h1{margin:0 0 10px;font-size:2.4rem;background:linear-gradient(135deg,#00d4aa,#00a8ff);-webkit-background-clip:text;color:transparent}.lede{color:#aaa;font-size:1.05rem;max-width:760px}pre{background:#181818;padding:14px 16px;border:1px solid #222;border-radius:8px;overflow:auto;font-size:.85rem}code{font-family:ui-monospace,Monaco,Consolas,monospace;color:#00a8ff}.breadcrumb{font-size:.7rem;letter-spacing:.12em;text-transform:uppercase;color:#888;margin:0 0 12px}.nav-inline{display:flex;gap:20px;align-items:center;font-size:.8rem;padding:10px 20px;background:#111;border-bottom:1px solid #222}nav a{color:#aaa}nav a[aria-current="page"]{color:#00d4aa;font-weight:600}</style></head><body><nav class="nav-inline"><a href="/" >Home</a><a href="/docs/index.html" aria-current="page">Docs</a><a href="/dashboard">Dashboard</a><a href="/about.html">About</a></nav><header class="page-hero"><div class="breadcrumb">Docs / Trust Metrics Dashboard Design (Draft)</div><h1>Trust Metrics Dashboard Design (Draft)</h1><p class="lede">Purpose: Provide a scrappy, real-time window into multi-dimensional trust signals (domain, casino, degen/user) with emphasis on top movers, severity distribution, and snapshot thro</p></header><main id="content"><h1>Trust Metrics Dashboard Design (Draft)</h1>

<p>Purpose: Provide a scrappy, real-time window into multi-dimensional trust signals (domain, casino, degen/user) with emphasis on top movers, severity distribution, and snapshot throttle health. Enables rapid detection of emerging malicious domains, unusual casino trust swings, and abuse of snapshot requests.</p>

<h2>Core Objectives</h2>
<p>1. Surface Top Movers (negative domain deltas, positive/negative casino deltas).</p>
<p>2. Visualize Severity Distribution (last hour events bucketed by severity 1â€“5).</p>
<p>3. Expose Snapshot Throttle Status (age, next allowed, throttled count).</p>
<p>4. Provide Recent Degen Trust Events (social/reputation activity feed).</p>
<p>5. Maintain Scrappy Infra: file-based snapshots + lightweight in-memory event relay.</p>

<h2>Data Sources</h2>
<p>| Source | File / Stream | Purpose |</p>
<p>|--------|---------------|---------|</p>
<p>| trust-rollup service | <code>data/trust-rollups.json</code> | Hourly aggregate deltas (domain + casino) |</p>
<p>| SusLink / LinkGuard | <code>data/domain-trust-scores.json</code> | Current domain scores baseline |</p>
<p>| JustTheTip | <code>data/justthetip-user-trust.json</code> (if present) | User (degen) trust scores |</p>
<p>| Event Router (in-memory) | SSE/WebSocket bridge | Live push of <code>trust.*.updated</code> events |</p>
<p>| Event Router (throttle responder) | <code>trust.state.snapshot</code> events | On-demand snapshot summary |</p>

<h2>Metrics & Widgets</h2>
<h3>1. Domain Movers (Table)</h3>
<p>Columns: Rank, Domain, Î” (last hour totalDelta), Events, Last Severity Badge, Current Score.</p>
<p>Sorting: totalDelta ascending (most negative first). Highlight rows: severity >=4 red background tint.</p>
<p>Source: latest batch in <code>trust-rollups.json</code> domain -> <code>domains</code> map.</p>

<h3>2. Casino Movers (Dual Tables)</h3>
<p>Positive Movers: sort by totalDelta desc (top reinforcement). Negative Movers: sort by totalDelta asc.</p>
<p>Show: Casino, totalDelta, events, lastScore.</p>

<h3>3. Severity Distribution (Bar / Donut)</h3>
<p>Derive counts of event severities (1â€“5) from live event buffer (rolling 60 min) maintained by dashboard server.</p>
<p>Fallback: if buffer thin, approximate using last rollup's lastSeverity occurrences.</p>

<h3>4. Snapshot Health Panel</h3>
<p>Fields:</p>
<ul>
<li>Last Snapshot Received At (ISO + relative time)</li>
<li>Age (seconds since)</li>
<li>Throttled Requests (count since startup)</li>
<li>Next Allowed Request ETA (throttle window minus elapsed)</li>
<p>Indicators:</p>
<li>Green: age < 30s</li>
<li>Yellow: 30sâ€“120s</li>
<li>Red: >120s (stale)</li>
<p>Data: tracked client-side by injecting timestamp when <code>trust.state.snapshot</code> arrives; increment on log line "Snapshot request throttled" (if exposed) or throttle response counter event (optional enhancement).</p>
</ul>

<h3>5. Live Event Ticker</h3>
<p>Streams last N (e.g. 50) trust events across domain, casino, degen.</p>
<p>Format: Timestamp, Type, Entity (domain/casino/user), Î”, Severity badge, Reason.</p>
<p>Color: severity-based emoji (ðŸŸ¢ðŸŸ¡ðŸŸ ðŸ”´) preceding line.</p>

<h3>6. Degen Trust Leaderboard</h3>
<p>Top 15 users by score; ability to toggle between absolute score and 24h delta (requires small rolling aggregation in dashboard server â€“ map userId -> last 24h delta).</p>

<h3>7. Risk Alerts Panel (Optional Phase 2)</h3>
<p>Criteria:</p>
<ul>
<li>Domain totalDelta <= -40 in current hour window.</li>
<li>Casino totalDelta <= -25.</li>
<li>Severity 5 event for a previously safe domain.</li>
<p>Displays actionable alert cards with first-seen timestamp and current score.</p>
</ul>

<h2>Architecture Overview</h2>
<pre class="code-block" data-lang=""><code>
Browser (SPA) &lt;â€”(SSE/WebSocket)â€” Dashboard Server (Node/Express)
                                |-- Periodic file reads (every 30s) of snapshot JSONs
                                |-- Subscribes to eventRouter in-process (same monorepo run)
                                |-- Maintains in-memory buffers: events[], severityCounts, userDeltas
                                |-- Provides /api/rollups, /api/domain-scores, /api/degen-scores
</code></pre>

<h2>Implementation Plan (Incremental)</h2>
<p>1. Server Skeleton (<code>services/dashboard/</code>): Express + SSE endpoint <code>/events</code> + JSON REST endpoints.</p>
<p>2. Event Bridge: import <code>eventRouter</code> and subscribe to trust events, push to SSE clients.</p>
<p>3. File Poller: read JSON snapshots every 30s (debounce, avoid blocking); parse to in-memory state.</p>
<p>4. Throttle Tracking: listen for <code>trust.state.snapshot</code> + maintain lastSnapshotTs; intercept snapshot requests triggered by UI and measure time difference if throttled message logged.</p>
<p>5. Frontend (Static HTML + Minimal JS): tables + simple aggregated counters; leverage CSS only initially.</p>
<p>6. Charts (Phase 2): add Chart.js (CDN) for severity distribution and sparkline of top domain score trajectory (pull from aggregated deltas).</p>
<p>7. Risk Alerts (Phase 2): evaluate domain/casino thresholds each poll and update alert list.</p>

<h2>API Endpoints (Initial)</h2>
<ul>
<li><code>GET /api/rollups/latest</code> â†’ latest batch from <code>trust-rollups.json</code>.</li>
<li><code>GET /api/domains</code> â†’ array of <code>{ domain, score }</code> from domain snapshot.</li>
<li><code>GET /api/degens</code> â†’ array of <code>{ userId, score }</code> (if file exists).</li>
<li><code>GET /api/health</code> â†’ <code>{ lastSnapshotTs, throttledCount, eventBufferSize }</code>.</li>
<li><code>GET /api/severity</code> â†’ current severity buckets counts (derived from buffer).</li>
</ul>

<h2>Data Structures</h2>
<pre class="code-block" data-lang="ts"><code>
interface DashboardState {
  events: Array&lt;{
    ts: number;
    type: string;
    entity: string;
    delta?: number;
    severity?: number;
    reason?: string;
  }&gt;;
  severityBuckets: Record&lt;number, number&gt;; // 1..5
  lastSnapshotTs?: number;
  throttledCount: number;
  userDeltas24h: Map&lt;string, number&gt;; // recompute hourly prune
}
</code></pre>

<h2>Polling & Retention Policies</h2>
<ul>
<li>Event Buffer: keep last 500 trust events; prune FIFO.</li>
<li>User 24h Delta: compute on insertion; maintain map of arrays of deltas with timestamps; prune entries older than 24h hourly.</li>
<li>File Poll Interval: 30s (adjustable env var <code>DASHBOARD_POLL_MS</code>).</li>
</ul>

<h2>Severity Bucketing</h2>
<p>Map raw <code>severity</code> (1â€“5) directly; unknown / missing severity counts under bucket 1 (lowest) to avoid distortions.</p>

<h2>Snapshot Request UX</h2>
<p>Button "Refresh Snapshot" triggers POST <code>/api/request-snapshot</code> which internally publishes <code>trust.state.requested</code> event; disables button if snapshot age < throttle window (5s) showing countdown.</p>

<h2>Security & Safety</h2>
<ul>
<li>No PII beyond user IDs (Discord IDs acceptable for internal tooling but can be hashed if needed).</li>
<li>Rate-limit <code>/api/request-snapshot</code> per IP (e.g. max 12/minute) to prevent circumvention of trust-rollup throttle.</li>
<li>Serve strictly over localhost or restricted VPN for internal operations.</li>
</ul>

<h2>Minimal Dependencies</h2>
<ul>
<li>Server: <code>express</code>, optional <code>cors</code>.</li>
<li>Frontend: vanilla JS + optional <code>chart.js</code> CDN.</li>
<li>No database; rely on existing JSON snapshot files and in-memory maps.</li>
</ul>

<h2>Future Enhancements</h2>
<p>1. Persistence of event buffer to disk (rotate daily) for historical analytics.</p>
<p>2. Anomaly detection (simple z-score on domain delta vs historical mean).</p>
<p>3. Webhook export for severity 5 domain events to external alerting (Discord channel / Slack).</p>
<p>4. Integrate tilt-related events (e.g. <code>tilt.detected</code>) as overlay metrics.</p>

<h2>Acceptance Criteria (MVP)</h2>
<ul>
<li>Page loads and displays domain movers, casino movers using latest rollup file.</li>
<li>Live events append to ticker within <1s of publication.</li>
<li>Severity distribution chart updates in real-time.</li>
<li>Snapshot health indicator reflects age and throttle state accurately.</li>
<li>Request snapshot button respects throttle and updates last snapshot timestamp on success.</li>
</ul>

<p>---</p>
<p>Status: Draft ready for implementation. Next step: scaffold <code>services/dashboard/</code> with server + SSE.</p>
</main><footer style="padding:40px 24px;text-align:center;font-size:.75rem;color:#666;border-top:1px solid #222">TiltCheck Docs â€¢ Non-custodial â€¢ Signals only.</footer></body></html>